(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{"+B5j":function(t,r,e){"use strict";function o(t,r){for(var e=0;e<r.length;e++){var o=r[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}e.d(r,"a",(function(){return n}));var n=function(){function t(r){!function(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}(this,t),this.loader=r}var r,e,n;return r=t,(e=[{key:"upload",value:function(){return this.loader.file.then((function(t){return new Promise((function(r,e){var o=new FormData;o.append("image",t),axios.post("/api/images",o).then((function(t){201===t.status?r({default:t.data.path}):e(t.data.message)})).catch((function(t){console.log(t.response.status,t.response.data.message)}))}))}))}},{key:"abort",value:function(){}}])&&o(r.prototype,e),n&&o(r,n),t}()},Mtlz:function(t,r,e){"use strict";function o(t){try{var r=(o=t,(new DOMParser).parseFromString(o,"text/html"));return e=r,Array.from(e.images,(function(t){return{src:t.getAttribute("src").toString()}}))}catch(t){alert(t)}var e,o;return dst}e.d(r,"a",(function(){return o}))},YjVN:function(t,r,e){"use strict";e.r(r);var o=e("o0o1"),n=e.n(o),a=e("DxOX"),s=e("L2JU"),i=e("+z1p"),u=e.n(i),c=e("+B5j"),l=e("Mtlz"),p=e("x6DR");function f(t,r,e,o,n,a,s){try{var i=t[a](s),u=i.value}catch(t){return void e(t)}i.done?r(u):Promise.resolve(u).then(o,n)}function d(t){return function(){var r=this,e=arguments;return new Promise((function(o,n){var a=t.apply(r,e);function s(t){f(a,o,n,s,i,"next",t)}function i(t){f(a,o,n,s,i,"throw",t)}s(void 0)}))}}function m(t,r){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),e.push.apply(e,o)}return e}function b(t,r,e){return r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e,t}var g={components:{VueTagsInput:e.n(p).a},props:{id:{type:String,required:!0}},data:function(){return{post:null,loading:!1,postForm:{id:"",title:"",category_id:0,body:"",abstract:"",thumbnail:"",tags:[]},editor:u.a,editorData:"<p>Content of the editor.</p>",editorConfig:{language:"ja",extraPlugins:[this.uploadAdapter]},thumbnailImages:{},tag:"",validation:[{classes:"max-length",rule:function(t){return t.text.length>20}}],autocompleteItems:[]}},computed:function(t){for(var r=1;r<arguments.length;r++){var e=null!=arguments[r]?arguments[r]:{};r%2?m(Object(e),!0).forEach((function(r){b(t,r,e[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):m(Object(e)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}))}return t}({filteredItems:function(){var t=this;return this.autocompleteItems.filter((function(r){return-1!==r.text.toLowerCase().indexOf(t.tag.toLowerCase())}))}},Object(s.c)({apiStatus:function(t){return t.post.apiStatus},postErrors:function(t){return t.post.updatePostErrorMessages},registerdId:function(t){return t.post.registerdId}})),methods:{fetchPost:function(){var t=this;return d(n.a.mark((function r(){var e;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,axios.get("/api/posts/".concat(t.id));case 2:if((e=r.sent).status===a.d){r.next=6;break}return t.$store.commit("error/setCode",e.status),r.abrupt("return",!1);case 6:t.post=e.data,t.postForm.id=t.post.id,t.postForm.title=t.post.title,t.postForm.category_id=t.post.category_id,t.postForm.body=t.post.body,t.postForm.abstract=t.post.abstract,t.postForm.thumbnail=t.post.thumbnail,t.post.tags.forEach((function(r){t.postForm.tags.push(r.name)}));case 14:case"end":return r.stop()}}),r)})))()},fetchAutoCompleteTags:function(){var t=this;return d(n.a.mark((function r(){var e;return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,axios.get("/api/tags");case 2:if((e=r.sent).status===a.d){r.next=6;break}return t.$store.commit("error/setCode",e.status),r.abrupt("return",!1);case 6:t.autocompleteItems=e.data.data;case 7:case"end":return r.stop()}}),r)})))()},updatePost:function(){var t=this;return d(n.a.mark((function r(){return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$store.dispatch("post/updatePost",t.postForm);case 2:t.apiStatus&&t.$router.push("/posts/".concat(t.registerdId));case 3:case"end":return r.stop()}}),r)})))()},clearError:function(){this.$store.commit("post/setUpdatePostErrorMessages",null)},uploadAdapter:function(t){t.plugins.get("FileRepository").createUploadAdapter=function(t){return new c.a(t)}},fillThumbnail:function(t){this.postForm.thumbnail=t},checkTag:function(t){t.tag.text.length>20?console.log("タグは20文字まで"):t.addTag()}},watch:{$route:{handler:function(){var t=this;return d(n.a.mark((function r(){return n.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.fetchPost();case 2:return r.next=4,t.fetchAutoCompleteTags();case 4:case"end":return r.stop()}}),r)})))()},immediate:!0},"postForm.body":function(t){this.thumbnailImages=Object(l.a)(this.postForm.body)}},created:function(){this.clearError()}},h=e("KHd+"),v=Object(h.a)(g,(function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"container--small"},[e("h1",[t._v("記事の編集")]),t._v(" "),e("b-form",{staticClass:"form",on:{submit:function(r){return r.preventDefault(),t.updatePost(r)}}},[t.postErrors?e("div",{staticClass:"errors"},[t.postErrors.id?e("ul",t._l(t.postErrors.id,(function(r){return e("li",{key:r},[t._v(t._s(r))])})),0):t._e(),t._v(" "),t.postErrors.title?e("ul",t._l(t.postErrors.title,(function(r){return e("li",{key:r},[t._v(t._s(r))])})),0):t._e(),t._v(" "),t.postErrors.category_id?e("ul",t._l(t.postErrors.category_id,(function(r){return e("li",{key:r},[t._v(t._s(r))])})),0):t._e(),t._v(" "),t.postErrors.body?e("ul",t._l(t.postErrors.body,(function(r){return e("li",{key:r},[t._v(t._s(r))])})),0):t._e()]):t._e(),t._v(" "),e("b-form-group",{attrs:{"label-for":"title",label:"タイトル:"}},[e("b-form-input",{attrs:{type:"text",id:"title"},model:{value:t.postForm.title,callback:function(r){t.$set(t.postForm,"title",r)},expression:"postForm.title"}})],1),t._v(" "),e("b-form-group",{attrs:{"label-for":"category-id",label:"カテゴリーID:",description:"1:作品、2:コラム"}},[e("b-form-input",{attrs:{type:"text",id:"category-id"},model:{value:t.postForm.category_id,callback:function(r){t.$set(t.postForm,"category_id",r)},expression:"postForm.category_id"}})],1),t._v(" "),e("b-form-group",{attrs:{"label-for":"body",label:"本文"}},[e("ckeditor",{attrs:{editor:t.editor,config:t.editorConfig},model:{value:t.postForm.body,callback:function(r){t.$set(t.postForm,"body",r)},expression:"postForm.body"}})],1),t._v(" "),e("b-form-group",{attrs:{"label-for":"abstract",label:"要約",description:"記事一覧表示時に使われます。"}},[e("b-form-input",{attrs:{type:"text",id:"abstract"},model:{value:t.postForm.abstract,callback:function(r){t.$set(t.postForm,"abstract",r)},expression:"postForm.abstract"}})],1),t._v(" "),e("b-form-group",{attrs:{"label-for":"tags",label:"タグ"}},[e("vue-tags-input",{attrs:{tags:t.postForm.tags,"autocomplete-items":t.autocompleteItems,validation:t.validation},on:{"tags-changed":function(r){return t.postForm.tags=r},"before-adding-tag":t.checkTag},model:{value:t.tag,callback:function(r){t.tag=r},expression:"tag"}})],1),t._v(" "),e("b-form-group",{attrs:{"label-for":"thumbnail",label:"サムネイル",description:"候補一覧が表示されますので、そこから選んでください。"}},[e("b-form-input",{attrs:{type:"text",id:"thumbnail"},model:{value:t.postForm.thumbnail,callback:function(r){t.$set(t.postForm,"thumbnail",r)},expression:"postForm.thumbnail"}}),t._v(" "),e("b-row",t._l(t.thumbnailImages,(function(r){return e("b-col",{key:r.src,attrs:{cols:"4"}},[e("div",{staticClass:"thumbnail-button"},[e("button",{attrs:{type:"button"},on:{click:function(e){return t.fillThumbnail(r.src)}}},[e("b-img",{attrs:{thumbnail:"",fluid:"",src:r.src}})],1)])])})),1)],1),t._v(" "),e("b-button",{attrs:{type:"submit",variant:"primary"}},[t._v("投稿する")])],1)],1)}),[],!1,null,null,null);r.default=v.exports}}]);